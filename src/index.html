<html>
<head>
    <title>ASL Interpreter</title>
    <link rel="stylesheet" href="output.css">
</head>
<body class="font-[playfulKoala] bg-amber-50">
    <p class="w-full text-center text-8xl mt-10 text-amber-500 bg-amber-200">Welcome To AI for ASL</p>
    <div class="w-full content-center justify-center text-center">
        <form class="left-[12.5%] bg-amber-100 top-1/4 w-4/5 absolute border-solid rounded-2xl border-cyan-100 bottom-16" id="home_form" action="free_sign.html" >
            <label class="text-[6em]"for="fname">First Name:</label>
            <input type="text" class="text-center text-[5em] w-1/2 text-5xl box-border rounded-md" id="fname" name="fname" placeholder="Type here" required>
            <br><br>
            <label class="text-[6em]" for="cars">Grade Level: </label>
            <select class="text-center justify-center w-1/2 text-[5em]" name="grade" id="grade"  required>
                <option value="" selected disabled hidden>Select grade here</option>
                <option value="3">3rd</option>
                <option value="4">4th</option>
                <option value="5">5th</option>
                <option value="6">6th</option>
                <option value="7">7th</option>
                <option value="8">8th</option>
            </select>
            <br><br><br>
            <input class="bg-[rgb(76,175,80)] text-white text-[2em] border-2 rounded-2xl w-1/2 p-4 translate-y-1/4 hover:bg-[#247527]" type="submit" value="Submit" onclick="addUser()">
        </form>
    </div>
</body>

</html>

<script>
    /**
     * Add new users to locally stored JSON object
    **/
    function addUser() {
        let userData = localStorage.getItem('userData');
        let firstName = document.getElementById('fname').value;
        let grade = document.getElementById('grade').value;
        var date = new Date();
        var formattedDate = date.getDate() + "/"
            + (date.getMonth() + 1)  + "/"
            + date.getFullYear() + " - "
            + date.getHours() + ":"
            + date.getMinutes() + ":"
            + date.getSeconds();

        if (userData) {
            userData = JSON.parse(userData);
        } else {
            userData = {users: []};
        }
        userData.users.push({
            firstName: firstName,
            grade: grade,
            date: date
        });
        localStorage.setItem('userData', JSON.stringify(userData));
    }

    /**
     * Exports all users currently in localstorage
     * Download file in csv format
     *
     * This function should only be ran in console
    **/
    function exportUsers() {
        let userData = localStorage.getItem('userData');
        if (userData) {
            userData = JSON.parse(userData).users;
            let csvRows = [];
            const headers = ['ID', 'Name', 'Grade', 'Date/Time'];
            csvRows.push(headers.join(','));
            userData.forEach(function (user) {
                let newRow = [
                    csvRows.length,
                    user.firstName,
                    user.grade,
                    user.date
                ];

                csvRows.push(newRow.join(','))
            })
            csvRows = csvRows.join('\n')
            const blob = new Blob([csvRows], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob)
            const a = document.createElement('a')
            a.setAttribute('href', url)
            a.setAttribute('download', 'users.csv');
            a.click()
            console.log('Users have been exported!')
        } else {
            console.log("No user data to export!");
        }
    }
</script>
